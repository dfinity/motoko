<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>field_sources.ml &mdash; Coverage report</title>
    <meta name="description" content="22.86% coverage in mo_types/field_sources.ml">
    <link rel="stylesheet" href="../coverage.css"/>
    <script src="../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="../index.html">
          <span class="dirname">mo_types/</span>field_sources.ml
        </a>
      </h1>
      <h2>22.86%</h2>
    </div>
    <div id="navbar">
      <span class="unvisited" style="top:17.39%"></span>
      <span class="unvisited" style="top:20.29%"></span>
      <span class="unvisited" style="top:23.19%"></span>
      <span class="unvisited" style="top:27.54%"></span>
      <span class="unvisited" style="top:28.99%"></span>
      <span class="unvisited" style="top:31.88%"></span>
      <span class="unvisited" style="top:34.78%"></span>
      <span class="some-visited" style="top:47.83%"></span>
      <span class="some-visited" style="bottom:42.03%"></span>
      <span class="unvisited" style="bottom:34.78%"></span>
      <span class="unvisited" style="bottom:33.33%"></span>
      <span class="unvisited" style="bottom:31.88%"></span>
      <span class="unvisited" style="bottom:30.43%"></span>
      <span class="unvisited" style="bottom:27.54%"></span>
      <span class="unvisited" style="bottom:21.74%"></span>
      <span class="unvisited" style="bottom:18.84%"></span>
      <span class="unvisited" style="bottom:17.39%"></span>
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span > </span>
<a id="L6"></a><span > </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span > </span>
<a id="L10"></a><span > </span>
<a id="L11"></a><span > </span>
<a id="L12"></a><span class="unvisited"> </span>
<a id="L13"></a><span > </span>
<a id="L14"></a><span class="unvisited"> </span>
<a id="L15"></a><span > </span>
<a id="L16"></a><span class="unvisited"> </span>
<a id="L17"></a><span > </span>
<a id="L18"></a><span > </span>
<a id="L19"></a><span class="unvisited"> </span>
<a id="L20"></a><span class="unvisited"> </span>
<a id="L21"></a><span > </span>
<a id="L22"></a><span class="unvisited"> </span>
<a id="L23"></a><span > </span>
<a id="L24"></a><span class="unvisited"> </span>
<a id="L25"></a><span > </span>
<a id="L26"></a><span > </span>
<a id="L27"></a><span > </span>
<a id="L28"></a><span > </span>
<a id="L29"></a><span > </span>
<a id="L30"></a><span > </span>
<a id="L31"></a><span > </span>
<a id="L32"></a><span > </span>
<a id="L33"></a><span class="some-visited"> </span>
<a id="L34"></a><span > </span>
<a id="L35"></a><span > </span>
<a id="L36"></a><span > </span>
<a id="L37"></a><span > </span>
<a id="L38"></a><span > </span>
<a id="L39"></a><span class="visited"> </span>
<a id="L40"></a><span class="some-visited"> </span>
<a id="L41"></a><span > </span>
<a id="L42"></a><span > </span>
<a id="L43"></a><span > </span>
<a id="L44"></a><span > </span>
<a id="L45"></a><span class="unvisited"> </span>
<a id="L46"></a><span class="unvisited"> </span>
<a id="L47"></a><span class="unvisited"> </span>
<a id="L48"></a><span class="unvisited"> </span>
<a id="L49"></a><span > </span>
<a id="L50"></a><span class="unvisited"> </span>
<a id="L51"></a><span > </span>
<a id="L52"></a><span > </span>
<a id="L53"></a><span class="visited"> </span>
<a id="L54"></a><span class="unvisited"> </span>
<a id="L55"></a><span > </span>
<a id="L56"></a><span class="unvisited"> </span>
<a id="L57"></a><span class="unvisited"> </span>
<a id="L58"></a><span > </span>
<a id="L59"></a><span > </span>
<a id="L60"></a><span > </span>
<a id="L61"></a><span > </span>
<a id="L62"></a><span class="visited"> </span>
<a id="L63"></a><span > </span>
<a id="L64"></a><span class="visited"> </span>
<a id="L65"></a><span > </span>
<a id="L66"></a><span > </span>
<a id="L67"></a><span class="visited"> </span>
<a id="L68"></a><span > </span>
<a id="L69"></a><span class="visited"> </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1"> 1</a>
<a href="#L2"> 2</a>
<a href="#L3"> 3</a>
<a href="#L4"> 4</a>
<a href="#L5"> 5</a>
<a href="#L6"> 6</a>
<a href="#L7"> 7</a>
<a href="#L8"> 8</a>
<a href="#L9"> 9</a>
<a href="#L10">10</a>
<a href="#L11">11</a>
<a href="#L12">12</a>
<a href="#L13">13</a>
<a href="#L14">14</a>
<a href="#L15">15</a>
<a href="#L16">16</a>
<a href="#L17">17</a>
<a href="#L18">18</a>
<a href="#L19">19</a>
<a href="#L20">20</a>
<a href="#L21">21</a>
<a href="#L22">22</a>
<a href="#L23">23</a>
<a href="#L24">24</a>
<a href="#L25">25</a>
<a href="#L26">26</a>
<a href="#L27">27</a>
<a href="#L28">28</a>
<a href="#L29">29</a>
<a href="#L30">30</a>
<a href="#L31">31</a>
<a href="#L32">32</a>
<a href="#L33">33</a>
<a href="#L34">34</a>
<a href="#L35">35</a>
<a href="#L36">36</a>
<a href="#L37">37</a>
<a href="#L38">38</a>
<a href="#L39">39</a>
<a href="#L40">40</a>
<a href="#L41">41</a>
<a href="#L42">42</a>
<a href="#L43">43</a>
<a href="#L44">44</a>
<a href="#L45">45</a>
<a href="#L46">46</a>
<a href="#L47">47</a>
<a href="#L48">48</a>
<a href="#L49">49</a>
<a href="#L50">50</a>
<a href="#L51">51</a>
<a href="#L52">52</a>
<a href="#L53">53</a>
<a href="#L54">54</a>
<a href="#L55">55</a>
<a href="#L56">56</a>
<a href="#L57">57</a>
<a href="#L58">58</a>
<a href="#L59">59</a>
<a href="#L60">60</a>
<a href="#L61">61</a>
<a href="#L62">62</a>
<a href="#L63">63</a>
<a href="#L64">64</a>
<a href="#L65">65</a>
<a href="#L66">66</a>
<a href="#L67">67</a>
<a href="#L68">68</a>
<a href="#L69">69</a>
</pre>
<pre><code class="ocaml">(* Used by the language server to help track possible sources of an object
   field. As objects in Motoko are structural rather than nominal and may be
   subject to subtyping, this helps to overapproximate these sources.

   Note that the functionality of this module is enabled only when
   [!Mo_config.Flags.typechecker_combine_srcs = true], otherwise the functions
   will do nothing or return empty data structures. *)
module Srcs_tbl = Hashtbl.Make (struct
  type t = Source.region

  let equal l r =
    <span data-count="0">l</span>et open Source in
    let equal_pos l r =
      <span data-count="0">l</span>.line = r.line &amp;&amp; <span data-count="0">l</span>.column = r.column &amp;&amp; <span data-count="0">l</span>.file = r.file
    in
    equal_po<span data-count="0">s</span> l.left r.left &amp;&amp; <span data-count="0">e</span>qual_pos l.right r.right

  let hash s =
    <span data-count="0">l</span>et open Source in
    let combine_int h x = <span data-count="0">(</span>h * 65521) lxor x in
    let hash_pos {line; column; file} =
      <span data-count="0">c</span>ombine_int line (combine_in<span data-count="0">t</span> column (Int32.to_in<span data-count="0">t</span> (Hash.has<span data-count="0">h</span> file)))
    in
    combine_int (hash_po<span data-count="0">s</span> s.left) (hash_po<span data-count="0">s</span> s.right)
end)

type srcs_tbl = Source.Region_set.t Srcs_tbl.t
type t = srcs_tbl

module Srcs_map = struct
  include Source.Region_map

  let adjoin = unio<span data-count="1819">n</span> (fun _ rs1 rs2 -&gt; <span data-count="0">S</span>ome (Source.Region_set.unio<span data-count="0">n</span> rs1 rs2))
end

type srcs_map = Source.Region_set.t Srcs_map.t

let empty_srcs_tbl () =
  <span data-count="12842775">l</span>et initial_size =
    if !Mo_config.Flags.typechecker_combine_srcs then <span data-count="0">1</span>023 else <span data-count="12842775">0</span>
  in
  Srcs_tbl.create initial_size

let get_srcs srcs_tbl r =
  <span data-count="0">i</span>f !Mo_config.Flags.typechecker_combine_srcs then
    <span data-count="0">O</span>ption.value
      ~default:(Source.Region_set.singleto<span data-count="0">n</span> r)
      (Srcs_tbl.find_op<span data-count="0">t</span> srcs_tbl r)
  else
    <span data-count="0">S</span>ource.Region_set.empty

let add_src srcs_tbl region =
  <span data-count="694954">i</span>f !Mo_config.Flags.typechecker_combine_srcs then
    <span data-count="0">l</span>et srcs =
      match Srcs_tbl.find_opt srcs_tbl region with
      | <span data-count="0">N</span>one -&gt; Source.Region_set.singleto<span data-count="0">n</span> region
      | <span data-count="0">S</span>ome srcs -&gt; Source.Region_set.ad<span data-count="0">d</span> region srcs
    in
    Srcs_tbl.replace srcs_tbl region srcs

let of_immutable_map srcs_map =
  <span data-count="8241">s</span>rcs_map
  |&gt; Source.Region_map.to_seq
  |&gt; <span data-count="8241">S</span>rcs_tbl.of_seq

let of_mutable_tbl srcs_tbl =
  <span data-count="6676">s</span>rcs_tbl
  |&gt; Srcs_tbl.to_seq
  |&gt; <span data-count="6676">S</span>ource.Region_map.of_seq
</code></pre>
      </div>
    </div>
    <script src="../coverage.js"></script>
  </body>
</html>
