field $message_async: Int
 define $Perm($Self) (((true && acc(($Self).flag,write)) && acc(($Self).$message_async,write)))
 define $Inv($Self) (true)
 method __init__($Self: Ref)
     
     requires $Perm($Self)
     ensures $Perm($Self)
     ensures $Inv($Self)
     { 
       ($Self).flag := false
       ($Self).$message_async := 0 
     }
 field flag: Bool
 method claim($Self: Ref)
     
     requires $Perm($Self)
     requires $Inv($Self)
     ensures $Perm($Self)
     ensures $Inv($Self)
     { 
       ($Self).flag := true
       ($Self).flag := false
       ($Self).$message_async := (($Self).$message_async + 1)
       exhale ($Perm($Self) && $Inv($Self))
       { 
          inhale ($Perm($Self) && ($Inv($Self) && (($Self).$message_async > 0)))
          ($Self).$message_async := (($Self).$message_async - 1)
          { 
             ($Self).flag := true 
           }
          exhale ($Perm($Self) && $Inv($Self)) 
        }
       inhale ($Perm($Self) && $Inv($Self)) 
     }
