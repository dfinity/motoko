field $message_async: Int
define $Perm($Self) ((((true && acc(($Self).claimed,write)) && acc(($Self).count,write)) && 
  acc(($Self).$message_async,write)))
define $Inv($Self) (true)
method __init__($Self: Ref) 
  requires (((true && acc(($Self).claimed,write)) && acc(($Self).count,write)) && 
             acc(($Self).$message_async,write))
  ensures (((true && acc(($Self).claimed,write)) && acc(($Self).count,write)) && 
            acc(($Self).$message_async,write))
   { 
     ($Self).claimed := false
     ($Self).count := 0
     ($Self).$message_async := 0 
   }
field claimed: Bool
field count: Int
method claim($Self: Ref) 
  requires (((true && acc(($Self).claimed,write)) && acc(($Self).count,write)) && 
             acc(($Self).$message_async,write))
  ensures (((true && acc(($Self).claimed,write)) && acc(($Self).count,write)) && 
            acc(($Self).$message_async,write))
   { 
     if (!($Self).claimed)
        { 
          ($Self).$message_async := (($Self).$message_async + 1)
          exhale ($Perm($Self) && $Inv($Self))
          { 
             inhale ($Perm($Self) && $Inv($Self))
             ($Self).$message_async := (($Self).$message_async - 1)
             { 
                ($Self).claimed := true
                ($Self).count := 1 
              }
             exhale ($Perm($Self) && $Inv($Self)) 
           }
          inhale ($Perm($Self) && $Inv($Self)) 
        } 
   }
