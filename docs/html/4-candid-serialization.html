<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>md/icp-features/4-candid-serialization.md</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">md/icp-features/4-candid-serialization.md</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#candid-serialization" id="toc-candid-serialization">Candid
serialization</a>
<ul>
<li><a href="#autogenerated-candid-interfaces"
id="toc-autogenerated-candid-interfaces">Autogenerated Candid
interfaces</a></li>
<li><a href="#candid-operators" id="toc-candid-operators">Candid
operators</a>
<ul>
<li><a href="#to_candid"
id="toc-to_candid"><code>to_candid</code></a></li>
<li><a href="#from_candid"
id="toc-from_candid"><code>from_candid</code></a></li>
</ul></li>
<li><a href="#dynamic-calls" id="toc-dynamic-calls">Dynamic
calls</a></li>
<li><a href="#resources" id="toc-resources">Resources</a></li>
</ul></li>
</ul>
</nav>
<h1 id="candid-serialization">Candid serialization</h1>
<p>Candid is an interface description language and serialization format
designed specifically for the Internet Computer Protocol. Candid serves
as the standard communication protocol between canisters. When one
canister calls another, the arguments are serialized to Candid,
transmitted, and then deserialized by the receiving canister. This
standardization enables developers to create frontends in languages like
JavaScript that can easily interact with backend canisters written in
Motoko or Rust. Candid uses strong typing to guarantee accurate data
interpretation and an efficient binary format for encoding data, making
it ideal for network transmission. Importantly, Candid's design allows
for backwards-compatible upgrades of canister interfaces.</p>
<p>Motoko automatically generates Candid interfaces for canisters and
provides built-in functions like <code>to_candid</code> and
<code>from_candid</code> for easy serialization and deserialization of
data to and from Candid format.</p>
<h2 id="autogenerated-candid-interfaces">Autogenerated Candid
interfaces</h2>
<p>When Motoko code is compiled, a Candid interface file <a
href="https://internetcomputer.org/docs/building-apps/interact-with-canisters/candid/using-candid#the-did-file">(<code>.did</code>)</a>
for the canister's public methods is automatically generated. This file
is used to ensure data passed into and returned from these methods is
automatically encoded to and decoded from Candidâ€™s binary format.</p>
<p>Motoko canisters automatically handle the serialization and
deserialization of data when the canister interacts with <a
href="https://internetcomputer.org/docs/building-apps/essentials/message-execution">inter-canister
calls or ingress messages</a>.</p>
<h2 id="candid-operators">Candid operators</h2>
<p>Motoko provides the <code>to_candid</code> and
<code>from_candid</code> functions for serializing and deserializing
Candid-encoded data.</p>
<p>:::danger It's important to note that there are many valid Candid
encodings, and therefore many different <code>Blob</code>
representations, for the same value. As a result, <code>to_candid</code>
does not guarantee that the same input will always produce the same
<code>Blob</code>. You should never use the output of
<code>to_candid</code> to compare values for equality or to compute
hashes. :::</p>
<p>In most cases, explicit serialization using <code>to_candid</code>
and <code>from_candid</code> is unnecessary during regular development.
These functions are typically reserved for advanced scenarios, such
as:</p>
<ul>
<li><p>Making dynamic calls to arbitrary canisters.</p></li>
<li><p>Handling raw binary data for storage or transmission.</p></li>
<li><p>Managing stable data formats during canister upgrades.</p></li>
</ul>
<p>For most common interactions, Candid serialization is handled
automatically by the Motoko compiler.</p>
<h3 id="to_candid"><code>to_candid</code></h3>
<p>The <code>to_candid</code> serializes Motoko values into a
Candid-encoded binary <code>Blob</code>. This is useful when explicitly
encoding data for storage, transmission between canisters, or dynamic
inter-canister calls. The <code>to_candid</code> function can accept one
or multiple arguments separated by commas.</p>
<pre class="motoko"><code>let encoding =  to_candid(true, &quot;hello&quot;, 68, -90) // (Bool, Text, Nat, Int)</code></pre>
<p>Each argument must be composed of sharable types. The resulting
<code>Blob</code> precisely represents the original Motoko values
according to Candid specifications.</p>
<pre class="motoko"><code>import Debug &quot;mo:core/Debug&quot;;

actor {
  public type User = {
    userId : Nat;
    name : Text;
  };
  
  public func serializeUser(user : User) : async Blob {
    let encodedData : Blob = to_candid(user);
    Debug.print(&quot;User data serialized successfully.&quot;);
    encodedData;
  };
}</code></pre>
<h3 id="from_candid"><code>from_candid</code></h3>
<p>The <code>from_candid</code> function deserializes a Candid-encoded
binary <code>Blob</code> back into Motoko values. This explicit decoding
is useful in scenarios where serialized data needs to be processed or
restored, such as reading from stable storage or handling dynamic
input.</p>
<p>To decode a <code>Blob</code> correctly, <code>from_candid</code>
requires an explicit type annotation or a clear type context. The result
is returned as an optional (<code>?</code>) value, allowing you to
safely handle potential failures caused by type mismatches or malformed
data.</p>
<pre class="motoko"><code>import Debug &quot;mo:core/Debug&quot;;

actor {
  public type User = {
    userId : Nat;
    name : Text;
  };

  public func deserializeUser(encodedData : Blob) : async ?User {
    let decodedUser : ?User = from_candid(encodedData);

    switch decodedUser {
      case (?user) {
        Debug.print(&quot;User data deserialized successfully.&quot;);
        return ?user;
      };
      case null {
        Debug.print(&quot;Deserialization failed: Invalid blob or type mismatch.&quot;);
        return null;
      };
    };
  };
}</code></pre>
<h2 id="dynamic-calls">Dynamic calls</h2>
<p>Although most canisters on ICP support Candid, this is not a
requirement enforced by the network. At the protocol level, canisters
communicate in raw binary data. Candid is just a common interpretation
of that data that allows canisters written in different languages to
interoperate.</p>
<p>Most users should never need to use <code>to_candid</code> and
<code>from_candid</code>, however one scenario in which these operations
are useful is when canister methods are called
<strong>dynamically</strong> using the <code>call</code> function from
the <code>InternetComputer</code> core module. The <code>call</code>
function takes a canister <code>Principal</code>, the name of a method
as <code>Text</code>, and a raw binary <code>Blob</code>, then returns a
future containing the result of the call, also as a raw binary
<code>Blob</code>. Typically, you might use <code>to_candid</code> to
prepare the argument of a call and <code>from_candid</code> to process
its result.</p>
<p>Dynamic calls are particularly useful when working with canisters or
services that have complex or non-standard interfaces, or when you need
fine-grained control over the calling process. However, they require
manual handling of binary encoding and decoding, which is more
error-prone than using the high-level abstractions provided by
Motoko.</p>
<p>In this example, use the imported <code>call</code> function to make
a dynamic call on the actor:</p>
<pre class="motoko"><code>import Principal &quot;mo:core/Principal&quot;;
import { call } &quot;mo:core/InternetComputer&quot;;

persistent actor MyActor {

   public func concat(ts : [Text]) : async Text {
      var r = &quot;&quot;;
      for (t in ts.values()) { r #= t };
      r
   };

   public func test() : async Text {
       let arguments = to_candid ([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]);
       let results = await call(Principal.fromActor(MyActor), &quot;concat&quot;, arguments);
       let ?t = from_candid(results) : ?Text;
       t
   }

}</code></pre>
<p>:::danger While dynamic calls offer more flexibility, they should be
used judiciously. In most cases, the standard inter-canister call
mechanisms and automatic Candid handling in Motoko provide a safer and
more convenient approach to canister interactions. :::</p>
<h2 id="resources">Resources</h2>
<p>For more detailed information on Candid, refer to:</p>
<ul>
<li><a
href="https://internetcomputer.org/docs/building-apps/interact-with-canisters/candid/candid-concepts">What
is Candid?</a></li>
<li><a
href="https://internetcomputer.org/docs/building-apps/interact-with-canisters/candid/using-candid">Using
Candid</a></li>
<li><a
href="https://internetcomputer.org/docs/references/candid-ref">Candid
Specification</a></li>
</ul>
</body>
</html>
